
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>mtpy.modeling.occam1d &#8212; mtpy 1.01.01 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_doc.html">mtpy 1.01.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for mtpy.modeling.occam1d</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">==================</span>
<span class="sd">Occam1D</span>
<span class="sd">==================</span>

<span class="sd">    * Wrapper class to interact with Occam1D written by Kerry Keys at Scripps </span>
<span class="sd">      adapted from the method of Constable et al., [1987].</span>

<span class="sd">    * This class only deals with the MT functionality of the Fortran code, so</span>
<span class="sd">      it can make the input files for computing the 1D MT response of an input</span>
<span class="sd">      model and or data.  It can also read the output and plot them in a</span>
<span class="sd">      useful way.</span>

<span class="sd">    * Note that when you run the inversion code, the convergence is quite</span>
<span class="sd">      quick, within the first few iterations, so have a look at the L2 cure</span>
<span class="sd">      to decide which iteration to plot, otherwise if you look at iterations</span>
<span class="sd">      long after convergence the models will be unreliable.</span>



<span class="sd">    * Key, K., 2009, 1D inversion of multicomponent, multi-frequency marine</span>
<span class="sd">      CSEM data: Methodology and synthetic studies for resolving thin</span>
<span class="sd">      resistive layers: Geophysics, 74, F9–F20.</span>

<span class="sd">    * The original paper describing the Occam&#39;s inversion approach is:</span>

<span class="sd">    * Constable, S. C., R. L. Parker, and C. G. Constable, 1987,</span>
<span class="sd">      Occam’s inversion –– A practical algorithm for generating smooth</span>
<span class="sd">      models from electromagnetic sounding data, Geophysics, 52 (03), 289–300.</span>


<span class="sd">    :Intended Use: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.occam1d as occam1d</span>
<span class="sd">        &gt;&gt;&gt; #--&gt; make a data file</span>
<span class="sd">        &gt;&gt;&gt; d1 = occam1d.Data()</span>
<span class="sd">        &gt;&gt;&gt; d1.write_data_file(edi_file=r&#39;/home/MT/mt01.edi&#39;, res_err=10, phase_err=2.5,</span>
<span class="sd">        &gt;&gt;&gt; ...                save_path=r&quot;/home/occam1d/mt01/TE&quot;, mode=&#39;TE&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #--&gt; make a model file</span>
<span class="sd">        &gt;&gt;&gt; m1 = occam1d.Model()</span>
<span class="sd">        &gt;&gt;&gt; m1.write_model_file(save_path=d1.save_path, target_depth=15000)</span>
<span class="sd">        &gt;&gt;&gt; #--&gt; make a startup file</span>
<span class="sd">        &gt;&gt;&gt; s1 = occam1d.Startup()</span>
<span class="sd">        &gt;&gt;&gt; s1.data_fn = d1.data_fn</span>
<span class="sd">        &gt;&gt;&gt; s1.model_fn = m1.model_fn</span>
<span class="sd">        &gt;&gt;&gt; s1.save_path = m1.save_path</span>
<span class="sd">        &gt;&gt;&gt; s1.write_startup_file()</span>
<span class="sd">        &gt;&gt;&gt; #--&gt; run occam1d from python</span>
<span class="sd">        &gt;&gt;&gt; occam_path = r&quot;/home/occam1d/Occam1D_executable&quot;</span>
<span class="sd">        &gt;&gt;&gt; occam1d.Run(s1.startup_fn, occam_path, mode=&#39;TE&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #--plot the L2 curve</span>
<span class="sd">        &gt;&gt;&gt; l2 = occam1d.PlotL2(d1.save_path, m1.model_fn)</span>
<span class="sd">        &gt;&gt;&gt; #--&gt; see that iteration 7 is the optimum model to plot</span>
<span class="sd">        &gt;&gt;&gt; p1 = occam1d.Plot1DResponse()</span>
<span class="sd">        &gt;&gt;&gt; p1.data_te_fn = d1.data_fn</span>
<span class="sd">        &gt;&gt;&gt; p1.model_fn = m1.model_fn</span>
<span class="sd">        &gt;&gt;&gt; p1.iter_te_fn = r&quot;/home/occam1d/mt01/TE/TE_7.iter&quot;</span>
<span class="sd">        &gt;&gt;&gt; p1.resp_te_fn = r&quot;/home/occam1d/mt01/TE/TE_7.resp&quot;</span>
<span class="sd">        &gt;&gt;&gt; p1.plot()</span>

<span class="sd">@author: J. Peacock (Oct. 2013)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">MultipleLocator</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">mtpy.core.mt</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">import</span> <span class="nn">mtpy.utils.calculator</span> <span class="k">as</span> <span class="nn">mtcc</span>
<span class="kn">import</span> <span class="nn">mtpy.analysis.geometry</span> <span class="k">as</span> <span class="nn">mtg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">string</span>


<span class="c1"># ------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Data">[docs]</a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    reads and writes occam 1D data files</span>

<span class="sd">    ===================== =====================================================</span>
<span class="sd">    Attributes             Description</span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    _data_fn              basename of data file *default* is Occam1DDataFile</span>
<span class="sd">    _header_line          header line for description of data columns</span>
<span class="sd">    _ss                   string spacing *default* is 6*&#39; &#39;</span>
<span class="sd">    _string_fmt           format of data *default* is &#39;+.6e&#39;</span>
<span class="sd">    data                  array of data</span>
<span class="sd">    data_fn               full path to data file</span>
<span class="sd">    freq                  frequency array of data</span>
<span class="sd">    mode                  mode to invert for [ &#39;TE&#39; | &#39;TM&#39; | &#39;det&#39; ]</span>
<span class="sd">    phase_te              array of TE phase</span>
<span class="sd">    phase_tm              array of TM phase</span>
<span class="sd">    res_te                array of TE apparent resistivity</span>
<span class="sd">    res_tm                array of TM apparent resistivity</span>
<span class="sd">    resp_fn               full path to response file</span>
<span class="sd">    save_path             path to save files to</span>
<span class="sd">    ===================== =====================================================</span>


<span class="sd">    ===================== =====================================================</span>
<span class="sd">    Methods               Description</span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    write_data_file       write an Occam1D data file</span>
<span class="sd">    read_data_file        read an Occam1D data file</span>
<span class="sd">    read_resp_file        read a .resp file output by Occam1D</span>
<span class="sd">    ===================== =====================================================</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.occam1d as occam1d</span>
<span class="sd">        &gt;&gt;&gt; #--&gt; make a data file for TE mode</span>
<span class="sd">        &gt;&gt;&gt; d1 = occam1d.Data()</span>
<span class="sd">        &gt;&gt;&gt; d1.write_data_file(edi_file=r&#39;/home/MT/mt01.edi&#39;, res_err=10, phase_err=2.5,</span>
<span class="sd">        &gt;&gt;&gt; ...                save_path=r&quot;/home/occam1d/mt01/TE&quot;, mode=&#39;TE&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_string_fmt</span> <span class="o">=</span> <span class="s1">&#39;+.6e&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ss</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_fn</span> <span class="o">=</span> <span class="s1">&#39;Occam1d_DataFile&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header_line</span> <span class="o">=</span> <span class="s1">&#39;!</span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;      &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Freq#&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;TX#&#39;</span><span class="p">,</span> <span class="s1">&#39;Rx#&#39;</span><span class="p">,</span> <span class="s1">&#39;Data&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;Std_Error&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;det&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_te</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_tm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_te</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_tm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

<div class="viewcode-block" id="Data.write_data_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Data.write_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rp_tuple</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edi_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="n">res_err</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">phase_err</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">res_errorfloor</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">phase_errorfloor</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">z_errorfloor</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                        <span class="n">remove_outofquadrant</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make1Ddatafile will write a data file for Occam1D</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ---------</span>
<span class="sd">            **rp_tuple** : np.ndarray (freq, res, res_err, phase, phase_err)</span>
<span class="sd">                            with res, phase having shape (num_freq, 2, 2).</span>

<span class="sd">            **edi_file** : string</span>
<span class="sd">                          full path to edi file to be modeled.</span>

<span class="sd">            **save_path** : string</span>
<span class="sd">                           path to save the file, if None set to dirname of</span>
<span class="sd">                           station if edipath = None.  Otherwise set to</span>
<span class="sd">                           dirname of edipath.</span>

<span class="sd">            **thetar** : float</span>
<span class="sd">                         rotation angle to rotate Z. Clockwise positive and N=0</span>
<span class="sd">                         *default* = 0</span>

<span class="sd">            **mode** : [ &#39;te&#39; | &#39;tm&#39; | &#39;det&#39;]</span>
<span class="sd">                              mode to model can be (*default*=&#39;both&#39;):</span>
<span class="sd">                                - &#39;te&#39; for just TE mode (res/phase)</span>
<span class="sd">                                - &#39;tm&#39; for just TM mode (res/phase)</span>
<span class="sd">                                - &#39;det&#39; for the determinant of Z (converted to</span>
<span class="sd">                                        res/phase)</span>
<span class="sd">                              add &#39;z&#39; to any of these options to model</span>
<span class="sd">                              impedance tensor values instead of res/phase</span>


<span class="sd">            **res_err** : float</span>
<span class="sd">                        errorbar for resistivity values.  Can be set to (</span>
<span class="sd">                        *default* = &#39;data&#39;):</span>

<span class="sd">                        - &#39;data&#39; for errorbars from the data</span>
<span class="sd">                        - percent number ex. 10 for ten percent</span>

<span class="sd">            **phase_err** : float</span>
<span class="sd">                          errorbar for phase values.  Can be set to (</span>
<span class="sd">                          *default* = &#39;data&#39;):</span>

<span class="sd">                            - &#39;data&#39; for errorbars from the data</span>
<span class="sd">                            - percent number ex. 10 for ten percent</span>
<span class="sd">            **res_errorfloor**: float</span>
<span class="sd">                                error floor for resistivity values</span>
<span class="sd">                                in percent</span>
<span class="sd">            **phase_errorfloor**: float</span>
<span class="sd">                                  error floor for phase in degrees</span>
<span class="sd">            **remove_outofquadrant**: True/False; option to remove the resistivity and</span>
<span class="sd">                                      phase values for points with phases out</span>
<span class="sd">                                      of the 1st/3rd quadrant (occam requires</span>
<span class="sd">                                      0 &lt; phase &lt; 90 degrees; phases in the 3rd</span>
<span class="sd">                                      quadrant are shifted to the first by</span>
<span class="sd">                                      adding 180 degrees)</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam1d as occam1d</span>
<span class="sd">            &gt;&gt;&gt; #--&gt; make a data file</span>
<span class="sd">            &gt;&gt;&gt; d1 = occam1d.Data()</span>
<span class="sd">            &gt;&gt;&gt; d1.write_data_file(edi_file=r&#39;/home/MT/mt01.edi&#39;, res_err=10,</span>
<span class="sd">            &gt;&gt;&gt; ...                phase_err=2.5, mode=&#39;TE&#39;,</span>
<span class="sd">            &gt;&gt;&gt; ...                save_path=r&quot;/home/occam1d/mt01/TE&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># be sure that the input mode is not case sensitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;te&#39;</span><span class="p">:</span>
            <span class="n">d1_str</span> <span class="o">=</span> <span class="s1">&#39;RhoZxy&#39;</span>
            <span class="n">d2_str</span> <span class="o">=</span> <span class="s1">&#39;PhsZxy&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;tm&#39;</span><span class="p">:</span>
            <span class="n">d1_str</span> <span class="o">=</span> <span class="s1">&#39;RhoZyx&#39;</span>
            <span class="n">d2_str</span> <span class="o">=</span> <span class="s1">&#39;PhsZyx&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;det&#39;</span><span class="p">:</span>
            <span class="n">d1_str</span> <span class="o">=</span> <span class="s1">&#39;RhoZxy&#39;</span>
            <span class="n">d2_str</span> <span class="o">=</span> <span class="s1">&#39;PhsZxy&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;detz&#39;</span><span class="p">:</span>
            <span class="n">d1_str</span> <span class="o">=</span> <span class="s1">&#39;RealZxy&#39;</span>
            <span class="n">d2_str</span> <span class="o">=</span> <span class="s1">&#39;ImagZxy&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;tez&#39;</span><span class="p">:</span>
            <span class="n">d1_str</span> <span class="o">=</span> <span class="s1">&#39;RealZxy&#39;</span>
            <span class="n">d2_str</span> <span class="o">=</span> <span class="s1">&#39;ImagZxy&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;tmz&#39;</span><span class="p">:</span>
            <span class="n">d1_str</span> <span class="o">=</span> <span class="s1">&#39;RealZyx&#39;</span>
            <span class="n">d2_str</span> <span class="o">=</span> <span class="s1">&#39;ImagZyx&#39;</span>

        <span class="c1"># read in data as a tuple or .edi file</span>
        <span class="k">if</span> <span class="n">edi_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rp_tuple</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input either an edi file or rp_array&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">edi_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># read in edifile</span>
            <span class="n">mt_obj</span> <span class="o">=</span> <span class="n">mt</span><span class="o">.</span><span class="n">MT</span><span class="p">(</span><span class="n">edi_file</span><span class="p">)</span>
            <span class="n">z_obj</span> <span class="o">=</span> <span class="n">mt_obj</span><span class="o">.</span><span class="n">Z</span>
            <span class="n">z_obj</span><span class="o">.</span><span class="n">compute_resistivity_phase</span><span class="p">()</span>

            <span class="c1"># get frequencies to invert</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">freq</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>

            <span class="c1"># rotate if necessary</span>
            <span class="k">if</span> <span class="n">thetar</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">z_obj</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">thetar</span><span class="p">)</span>

            <span class="c1"># get the data requested by the given mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;te&#39;</span><span class="p">:</span>
                <span class="n">data_1</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">resistivity</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">resistivity_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">data_2</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">phase</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">phase_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;tm&#39;</span><span class="p">:</span>
                <span class="n">data_1</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">resistivity</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">resistivity_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="c1"># need to put the angle in the right quadrant</span>
                <span class="n">data_2</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">phase</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">180</span>
                <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">phase_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;det&#39;</span><span class="p">):</span>

                <span class="c1"># take square root as determinant is similar to z squared</span>
                <span class="n">zdetreal</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_obj</span><span class="o">.</span><span class="n">det</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
                <span class="n">zdetimag</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_obj</span><span class="o">.</span><span class="n">det</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">imag</span>

                <span class="c1"># error propagation - new error is 0.5 * relative error in zdet</span>
                <span class="c1"># then convert back to absolute error</span>
                <span class="n">zereal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zdetreal</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">det_err</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z_obj</span><span class="o">.</span><span class="n">det</span><span class="p">)</span>
                <span class="n">zeimag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zdetimag</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">det_err</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z_obj</span><span class="o">.</span><span class="n">det</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">):</span>
                    <span class="c1"># convert to si units if we are modelling impedance tensor</span>
                    <span class="n">data_1</span> <span class="o">=</span> <span class="n">zdetreal</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>
                    <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">zereal</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>
                    <span class="n">data_2</span> <span class="o">=</span> <span class="n">zdetimag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>
                    <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">zeimag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># convert to res/phase</span>
                    <span class="n">data_1</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span> <span class="o">/</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z_obj</span><span class="o">.</span><span class="n">det</span><span class="p">)</span>
                    <span class="n">data_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">zdetimag</span><span class="p">,</span> <span class="n">zdetreal</span><span class="p">))</span>

                    <span class="c1"># initialise error arrays</span>
                    <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data_1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                    <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data_2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

                    <span class="c1"># assign errors</span>
                    <span class="k">for</span> <span class="n">zdr</span><span class="p">,</span> <span class="n">zdi</span><span class="p">,</span> <span class="n">zer</span><span class="p">,</span> <span class="n">zei</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">zdetreal</span><span class="p">,</span> <span class="n">zdetimag</span><span class="p">,</span>
                                                      <span class="n">zereal</span><span class="p">,</span> <span class="n">zeimag</span><span class="p">,</span>
                                                      <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_obj</span><span class="o">.</span><span class="n">det</span><span class="p">))):</span>
                        <span class="c1"># now we can convert errors to polar coordinates</span>
                        <span class="n">de1</span><span class="p">,</span> <span class="n">de2</span> <span class="o">=</span> <span class="n">mtcc</span><span class="o">.</span><span class="n">z_error2r_phi_error</span><span class="p">(</span><span class="n">zdr</span><span class="p">,</span> <span class="n">zer</span><span class="p">,</span> <span class="n">zdi</span><span class="p">,</span> <span class="n">zei</span><span class="p">)</span>
                        <span class="n">data_1_err</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">de1</span>
                        <span class="n">data_2_err</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">de2</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;tez&#39;</span><span class="p">:</span>
                <span class="c1"># convert to si units</span>
                <span class="n">data_1</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>
                <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>

                <span class="n">data_2</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>
                <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;tmz&#39;</span><span class="p">:</span>
                <span class="c1"># convert to si units</span>
                <span class="n">data_1</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>
                <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>

                <span class="n">data_2</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>
                <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">z_obj</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Mode </span><span class="si">{0}</span><span class="s1"> is not supported.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">rp_tuple</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rp_tuple</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Be sure rp_array is correctly formated</span><span class="se">\n</span><span class="s1">&#39;</span>
                              <span class="s1">&#39;should be freq, res, res_err, phase, phase_err&#39;</span><span class="p">)</span>
            <span class="n">freq</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">rho_err</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">phi_err</span> <span class="o">=</span> <span class="n">rp_tuple</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="s1">&#39;te&#39;</span><span class="p">:</span>
                <span class="n">data_1</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">rho_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">data_2</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">phi_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="s1">&#39;tm&#39;</span><span class="p">:</span>
                <span class="n">data_1</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">rho_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="n">data_2</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">180</span>
                <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">phi_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;det&#39;</span> <span class="ow">in</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">data_1</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">rho_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">data_2</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">phi_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">remove_outofquadrant</span><span class="p">:</span>
            <span class="n">freq</span><span class="p">,</span> <span class="n">data_1</span><span class="p">,</span> <span class="n">data_1_err</span><span class="p">,</span> <span class="n">data_2</span><span class="p">,</span> <span class="n">data_2_err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_outofquadrant_phase</span><span class="p">(</span>
                <span class="n">freq</span><span class="p">,</span>
                <span class="n">data_1</span><span class="p">,</span>
                <span class="n">data_1_err</span><span class="p">,</span>
                <span class="n">data_2</span><span class="p">,</span>
                <span class="n">data_2_err</span><span class="p">)</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>

        <span class="c1"># ---&gt; get errors--------------------------------------</span>
        <span class="c1"># set error floors</span>
        <span class="k">if</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">z_errorfloor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_1_err</span><span class="p">)</span>
                <span class="n">test</span> <span class="o">=</span> <span class="n">data_1_err</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_1</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">data_2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">z_errorfloor</span> <span class="o">/</span> <span class="mf">100.</span>
                <span class="n">data_1_err</span><span class="p">[</span><span class="n">test</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_1</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">data_2</span><span class="p">)[</span><span class="n">test</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_errorfloor</span> <span class="o">/</span> <span class="mf">100.</span>
                <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">data_1_err</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">res_errorfloor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">test</span> <span class="o">=</span> <span class="n">data_1_err</span> <span class="o">/</span> <span class="n">data_1</span> <span class="o">&lt;</span> <span class="n">res_errorfloor</span> <span class="o">/</span> <span class="mf">100.</span>
                <span class="n">data_1_err</span><span class="p">[</span><span class="n">test</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_1</span><span class="p">[</span><span class="n">test</span><span class="p">]</span> <span class="o">*</span> <span class="n">res_errorfloor</span> <span class="o">/</span> <span class="mf">100.</span>
            <span class="k">if</span> <span class="n">phase_errorfloor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data_2_err</span><span class="p">[</span><span class="n">data_2_err</span> <span class="o">&lt;</span> <span class="n">phase_errorfloor</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase_errorfloor</span>

            <span class="k">if</span> <span class="n">res_err</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">data_1</span> <span class="o">*</span> <span class="n">res_err</span> <span class="o">/</span> <span class="mf">100.</span>
            <span class="k">if</span> <span class="n">phase_err</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">phase_err</span> <span class="o">/</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">nf</span><span class="p">)</span>

        <span class="c1"># --&gt; write file</span>
        <span class="c1"># make sure the savepath exists, if not create it</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">edi_file</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                    <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_fn</span><span class="p">,</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>

        <span class="c1"># --&gt; write file as a list of lines</span>
        <span class="n">dlines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Format:  EMData_1.1 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;!mode:   </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;!rotation_angle = </span><span class="si">{0:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thetar</span><span class="p">))</span>

        <span class="c1"># needs a transmitter to work so put in a dummy one</span>
        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# Transmitters: 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0 0 0 0 0 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># write frequencies</span>
        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# Frequencies:   </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nf</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">data_1</span> <span class="o">=</span> <span class="n">data_1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">data_2</span> <span class="o">=</span> <span class="n">data_2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">data_1_err</span> <span class="o">=</span> <span class="n">data_1_err</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">data_2_err</span> <span class="o">=</span> <span class="n">data_2_err</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">freq</span><span class="p">:</span>
            <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;   {0:</span><span class="si">{1}</span><span class="s1">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string_fmt</span><span class="p">))</span>

        <span class="c1"># needs a receiver to work so put in a dummy one</span>
        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# Receivers: 1 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0 0 0 0 0 0 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># write data</span>
        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# Data:</span><span class="si">{0}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nf</span><span class="p">))</span>
        <span class="n">num_data_line</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlines</span><span class="p">)</span>

        <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header_line</span><span class="p">)</span>
        <span class="n">data_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#        data1 = np.abs(data1)</span>
        <span class="c1">#        data2 = np.abs(data2)</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
            <span class="c1"># write lines</span>
            <span class="k">if</span> <span class="n">data_1</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">d1_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;{0:</span><span class="si">{1}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_1</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string_fmt</span><span class="p">),</span>
                                             <span class="s1">&#39;{0:</span><span class="si">{1}</span><span class="s1">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_1_err</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string_fmt</span><span class="p">)]))</span>
                <span class="n">data_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">data_2</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">dlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">d2_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;{0:</span><span class="si">{1}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_2</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string_fmt</span><span class="p">),</span>
                                             <span class="s1">&#39;{0:</span><span class="si">{1}</span><span class="s1">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_2_err</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string_fmt</span><span class="p">)]))</span>
                <span class="n">data_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># --&gt; write file</span>
        <span class="n">dlines</span><span class="p">[</span><span class="n">num_data_line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;# Data:</span><span class="si">{0}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="p">,</span> <span class="n">data_count</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dfid</span><span class="p">:</span>
            <span class="n">dfid</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">dlines</span><span class="p">)</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote Data File to : </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="c1"># --&gt; set attributes</span>

        <span class="k">if</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">data_1</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">data_2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="o">=</span> <span class="n">data_1_err</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;det&#39;</span> <span class="ow">in</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_det</span> <span class="o">=</span> <span class="n">data_1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_det</span> <span class="o">=</span> <span class="n">data_2</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;te&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_te</span> <span class="o">=</span> <span class="n">data_1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_te</span> <span class="o">=</span> <span class="n">data_2</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;tm&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_tm</span> <span class="o">=</span> <span class="n">data_1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_tm</span> <span class="o">=</span> <span class="n">data_2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_err</span> <span class="o">=</span> <span class="n">data_1_err</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_err</span> <span class="o">=</span> <span class="n">data_2_err</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span></div>

    <span class="k">def</span> <span class="nf">_remove_outofquadrant_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d1_err</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d2_err</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        remove out of quadrant phase from data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># remove data points with phase out of quadrant</span>
        <span class="k">if</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
            <span class="n">include</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span> <span class="o">/</span> <span class="n">d2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d1</span> <span class="o">/</span> <span class="n">d2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;te&#39;</span><span class="p">,</span> <span class="s1">&#39;tm&#39;</span><span class="p">]:</span>
            <span class="n">include</span> <span class="o">=</span> <span class="p">(</span><span class="n">d2</span> <span class="o">%</span> <span class="mi">180</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d2</span> <span class="o">%</span> <span class="mi">180</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d2</span> <span class="o">%</span> <span class="mi">180</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d2</span> <span class="o">%</span> <span class="mi">180</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">newfreq</span><span class="p">,</span> <span class="n">nd1</span><span class="p">,</span> <span class="n">nd1_err</span><span class="p">,</span> <span class="n">nd2</span><span class="p">,</span> <span class="n">nd2_err</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="n">include</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span>
                                                                        <span class="n">d1</span><span class="p">,</span> <span class="n">d1_err</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d2_err</span><span class="p">]]</span>
        <span class="c1"># fix any zero errors to 100% of the res value or 90 degrees for phase</span>
        <span class="n">nd1_err</span><span class="p">[</span><span class="n">nd1_err</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nd1</span><span class="p">[</span><span class="n">nd1_err</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
            <span class="n">nd2_err</span><span class="p">[</span><span class="n">nd2_err</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nd2</span><span class="p">[</span><span class="n">nd2_err</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nd2_err</span><span class="p">[</span><span class="n">nd2_err</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span>

        <span class="k">return</span> <span class="n">newfreq</span><span class="p">,</span> <span class="n">nd1</span><span class="p">,</span> <span class="n">nd1_err</span><span class="p">,</span> <span class="n">nd2</span><span class="p">,</span> <span class="n">nd2_err</span>

<div class="viewcode-block" id="Data.read_data_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Data.read_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads a 1D data file</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **data_fn** : full path to data file</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            **Occam1D.rpdict** : dictionary with keys:</span>

<span class="sd">                *&#39;freq&#39;* : an array of frequencies with length nf</span>

<span class="sd">                *&#39;resxy&#39;* : TE resistivity array with shape (nf,4) for (0) data,</span>
<span class="sd">                          (1) dataerr, (2) model, (3) modelerr</span>

<span class="sd">                *&#39;resyx&#39;* : TM resistivity array with shape (nf,4) for (0) data,</span>
<span class="sd">                          (1) dataerr, (2) model, (3) modelerr</span>

<span class="sd">                *&#39;phasexy&#39;* : TE phase array with shape (nf,4) for (0) data,</span>
<span class="sd">                            (1) dataerr, (2) model, (3) modelerr</span>

<span class="sd">                *&#39;phaseyx&#39;* : TM phase array with shape (nf,4) for (0) data,</span>
<span class="sd">                            (1) dataerr, (2) model, (3) modelerr</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; old = occam1d.Data()</span>
<span class="sd">            &gt;&gt;&gt; old.data_fn = r&quot;/home/Occam1D/Line1/Inv1_TE/MT01TE.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; old.read_data_file()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input a data file&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Could not find </span><span class="si">{0}</span><span class="s1">, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="n">dfid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="c1"># read in lines</span>
        <span class="n">dlines</span> <span class="o">=</span> <span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">dfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># make a dictionary of all the fields found so can put them into arrays</span>
        <span class="n">finddict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">fkey</span> <span class="o">=</span> <span class="n">dline</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fvalue</span> <span class="o">=</span> <span class="n">ii</span>
                <span class="n">finddict</span><span class="p">[</span><span class="n">fkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">fvalue</span>

        <span class="c1"># get number of frequencies</span>
        <span class="n">nfreq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s1">&#39;Frequencies&#39;</span><span class="p">]][</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="c1"># frequency list</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s1">&#39;Frequencies&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">finddict</span><span class="p">[</span><span class="s1">&#39;Receivers&#39;</span><span class="p">]]])</span>

        <span class="c1"># data dictionary to put things into</span>
        <span class="c1"># check to see if there is alread one, if not make a new one</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span>
                         <span class="s1">&#39;zxy&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span>
                         <span class="s1">&#39;zyx&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span>
                         <span class="s1">&#39;resxy&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">)),</span>
                         <span class="s1">&#39;resyx&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">)),</span>
                         <span class="s1">&#39;phasexy&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">)),</span>
                         <span class="s1">&#39;phaseyx&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">))}</span>

        <span class="c1"># get data</span>
        <span class="k">for</span> <span class="n">dline</span> <span class="ow">in</span> <span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dlst</span> <span class="o">=</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">dlst</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">dlst</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">jj</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">dvalue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">derr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RhoZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;103&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TE&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PhsZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;104&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TE&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RhoZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;105&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TM&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PhsZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;106&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TM&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RealZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;113&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TEz&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ImagZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;114&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TEz&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RealZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;115&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TMz&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ImagZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;116&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TMz&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
                <span class="n">pol</span> <span class="o">=</span> <span class="s1">&#39;xy&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;TM&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
                <span class="n">pol</span> <span class="o">=</span> <span class="s1">&#39;yx&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;res&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">freq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;res&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;res&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">jjj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;res&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jjj</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jjj</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">mtcc</span><span class="o">.</span><span class="n">z_error2r_phi_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jjj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jjj</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jjj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jjj</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">freq</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resxy&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resyx&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phasexy&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phaseyx&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Data.read_resp_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Data.read_resp_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_resp_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resp_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read response file</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ---------</span>
<span class="sd">            **resp_fn** : full path to response file</span>

<span class="sd">            **data_fn** : full path to data file</span>

<span class="sd">        Fills:</span>
<span class="sd">        --------</span>

<span class="sd">            *freq* : an array of frequencies with length nf</span>

<span class="sd">            *res_te* : TE resistivity array with shape (nf,4) for (0) data,</span>
<span class="sd">                      (1) dataerr, (2) model, (3) modelerr</span>

<span class="sd">            *res_tm* : TM resistivity array with shape (nf,4) for (0) data,</span>
<span class="sd">                      (1) dataerr, (2) model, (3) modelerr</span>

<span class="sd">            *phase_te* : TE phase array with shape (nf,4) for (0) data,</span>
<span class="sd">                        (1) dataerr, (2) model, (3) modelerr</span>

<span class="sd">            *phase_tm* : TM phase array with shape (nf,4) for (0) data,</span>
<span class="sd">                        (1) dataerr, (2) model, (3) modelerr</span>

<span class="sd">       :Example: ::</span>
<span class="sd">            &gt;&gt;&gt; o1d = occam1d.Data()</span>
<span class="sd">            &gt;&gt;&gt; o1d.data_fn = r&quot;/home/occam1d/mt01/TE/Occam1D_DataFile_TE.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; o1d.read_resp_file(r&quot;/home/occam1d/mt01/TE/TE_7.resp&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input response file&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input data file&#39;</span><span class="p">)</span>
        <span class="c1"># --&gt; read in data file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">()</span>

        <span class="c1"># --&gt; read response file</span>
        <span class="n">dfid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="n">dlines</span> <span class="o">=</span> <span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">dfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">finddict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">fkey</span> <span class="o">=</span> <span class="n">dline</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fvalue</span> <span class="o">=</span> <span class="n">ii</span>
                <span class="n">finddict</span><span class="p">[</span><span class="n">fkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">fvalue</span>

        <span class="k">for</span> <span class="n">dline</span> <span class="ow">in</span> <span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dlst</span> <span class="o">=</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">jj</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">dvalue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">derr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                    <span class="n">rvalue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rerr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">rerr</span> <span class="o">=</span> <span class="mf">1000.</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RhoZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;103&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_te</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_te</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_te</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_te</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PhsZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;104&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_te</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_te</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_te</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_te</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RhoZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;105&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_tm</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_tm</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PhsZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;106&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_tm</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rvalue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_tm</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RealZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;113&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TEz&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ImagZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;114&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TEz&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">rvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RealZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;115&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TMz&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>
                    <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ImagZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;116&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;TMz&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">derr</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">rvalue</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">4e-4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>
        <span class="k">if</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
                <span class="n">pol</span> <span class="o">=</span> <span class="s1">&#39;xy&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;TM&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
                <span class="n">pol</span> <span class="o">=</span> <span class="s1">&#39;yx&#39;</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;res&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span> <span class="o">+</span> <span class="n">ii</span><span class="p">])</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;res&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;res&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span>
                    <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span> <span class="o">+</span> <span class="n">ii</span><span class="p">])</span>

                <span class="k">for</span> <span class="n">jjj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jjj</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">mtcc</span><span class="o">.</span><span class="n">z_error2r_phi_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span> <span class="o">+</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jjj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jjj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">0</span> <span class="o">+</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jjj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span> <span class="o">+</span> <span class="n">pol</span><span class="p">][</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jjj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pol</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resxy&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phasexy&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">pol</span> <span class="o">==</span> <span class="s1">&#39;yx&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resyx&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;phaseyx&#39;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read and write the model file fo Occam1D</span>

<span class="sd">    All depth measurements are in meters.</span>

<span class="sd">    ======================== ==================================================</span>
<span class="sd">    Attributes               Description</span>
<span class="sd">    ======================== ==================================================</span>
<span class="sd">    _model_fn                basename for model file *default* is Model1D</span>
<span class="sd">    _ss                      string spacing in model file *default* is 3*&#39; &#39;</span>
<span class="sd">    _string_fmt              format of model layers *default* is &#39;.0f&#39;</span>
<span class="sd">    air_layer_height         height of air layer *default* is 10000</span>
<span class="sd">    bottom_layer             bottom of the model *default* is 50000</span>
<span class="sd">    itdict                   dictionary of values from iteration file</span>
<span class="sd">    iter_fn                  full path to iteration file</span>
<span class="sd">    model_depth              array of model depths</span>
<span class="sd">    model_fn                 full path to model file</span>
<span class="sd">    model_penalty            array of penalties for each model layer</span>
<span class="sd">    model_preference_penalty array of model preference penalties for each layer</span>
<span class="sd">    model_prefernce          array of preferences for each layer</span>
<span class="sd">    model_res                array of resistivities for each layer</span>
<span class="sd">    n_layers                 number of layers in the model</span>
<span class="sd">    num_params               number of parameters to invert for (n_layers+2)</span>
<span class="sd">    pad_z                    padding of model at depth *default* is 5 blocks</span>
<span class="sd">    save_path                path to save files</span>
<span class="sd">    target_depth             depth of target to investigate</span>
<span class="sd">    z1_layer                 depth of first layer *default* is 10</span>
<span class="sd">    ======================== ==================================================</span>

<span class="sd">    ======================== ==================================================</span>
<span class="sd">    Methods                  Description</span>
<span class="sd">    ======================== ==================================================</span>
<span class="sd">    write_model_file         write an Occam1D model file, where depth increases</span>
<span class="sd">                             on a logarithmic scale</span>
<span class="sd">    read_model_file          read an Occam1D model file</span>
<span class="sd">    read_iter_file           read an .iter file output by Occam1D</span>
<span class="sd">    ======================== ==================================================</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; #--&gt; make a model file</span>
<span class="sd">        &gt;&gt;&gt; m1 = occam1d.Model()</span>
<span class="sd">        &gt;&gt;&gt; m1.write_model_file(save_path=r&quot;/home/occam1d/mt01/TE&quot;)</span>
<span class="sd">   &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;n_layers&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bottom_layer&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;target_depth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_z</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pad_z&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z1_layer&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">air_layer_height</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;zir_layer_height&#39;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_layerdepth_defaults</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ss</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_string_fmt</span> <span class="o">=</span> <span class="s1">&#39;.0f&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_fn</span> <span class="o">=</span> <span class="s1">&#39;Model1D&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_depth</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_penalty</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_prefernce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_preference_penalty</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_set_layerdepth_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z1_threshold</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">bottomlayer_threshold</span><span class="o">=</span><span class="mf">2.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set target depth, bottom layer and z1 layer, making sure all the layers</span>
<span class="sd">        are consistent with each other and will work in the inversion</span>
<span class="sd">        (e.g. check target depth is not deeper than bottom layer)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># if neither target_depth nor bottom_layer are set, set defaults</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span> <span class="o">=</span> <span class="mf">10000.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span> <span class="o">=</span> <span class="n">mtcc</span><span class="o">.</span><span class="n">roundsf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span> <span class="o">/</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span> <span class="o">=</span> <span class="mf">5.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span>
        <span class="c1"># if bottom layer less than a factor of 2 greater than target depth then adjust deeper</span>
        <span class="k">elif</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span> <span class="o">&lt;</span> <span class="n">bottomlayer_threshold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span> <span class="o">=</span> <span class="n">bottomlayer_threshold</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span>
            <span class="nb">print</span> <span class="s2">&quot;bottom layer not deep enough for target depth, set to </span><span class="si">{}</span><span class="s2"> m&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span> <span class="o">=</span> <span class="n">mtcc</span><span class="o">.</span><span class="n">roundsf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span> <span class="o">&lt;</span> <span class="n">z1_threshold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span> <span class="o">/</span> <span class="n">z1_threshold</span>
            <span class="nb">print</span> <span class="s2">&quot;z1 layer not deep enough for target depth, set to </span><span class="si">{}</span><span class="s2"> m&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">)</span>

<div class="viewcode-block" id="Model.write_model_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Model.write_model_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_model_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes a 1D model file for Occam1D.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>

<span class="sd">            **save_path** :path to save file to, if just path saved as</span>
<span class="sd">                          savepath\model.mod, if None defaults to dirpath</span>

<span class="sd">            **n_layers** : number of layers</span>

<span class="sd">            **bottom_layer** : depth of bottom layer in meters</span>

<span class="sd">            **target_depth** : depth to target under investigation</span>

<span class="sd">            **pad_z** : padding on bottom of model past target_depth</span>

<span class="sd">            **z1_layer** : depth of first layer in meters</span>

<span class="sd">            **air_layer_height** : height of air layers in meters</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>

<span class="sd">            **Occam1D.modelfn** = full path to model file</span>

<span class="sd">        ..Note: This needs to be redone.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; old = occam.Occam1D()</span>
<span class="sd">            &gt;&gt;&gt; old.make1DModelFile(savepath=r&quot;/home/Occam1D/Line1/Inv1_TE&quot;,</span>
<span class="sd">            &gt;&gt;&gt;                     nlayers=50,bottomlayer=10000,z1layer=50)</span>
<span class="sd">            &gt;&gt;&gt; Wrote Model file: /home/Occam1D/Line1/Inv1_TE/Model1D</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_fn</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ---------create depth layers--------------------</span>
            <span class="n">log_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span> <span class="o">-</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">),</span>
                                                     <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span><span class="p">),</span>
                                                     <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span>
                                <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_z</span><span class="p">)</span>
            <span class="n">ztarget</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zz</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">zz</span><span class="p">))</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span>
                                <span class="n">log_z</span><span class="p">])</span>
            <span class="n">log_zpad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span><span class="p">),</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span> <span class="o">-</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_depth</span><span class="p">),</span>
                                                        <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_layer</span><span class="p">),</span>
                                                        <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_z</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span>
                                   <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_z</span><span class="p">)</span>
            <span class="n">zpadding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zz</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">zz</span><span class="p">))</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span>
                                 <span class="n">log_zpad</span><span class="p">])</span>
            <span class="n">z_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ztarget</span><span class="p">,</span> <span class="n">zpadding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z_nodes</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                         <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_depth</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="c1"># make the model file</span>
        <span class="n">modfid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Format: Resistivity1DMod_1.0&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#LAYERS:    </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">))</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;!Set free values to -1 or ? </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;!penalize between 1 and 0,&#39;</span> <span class="o">+</span>
                     <span class="s1">&#39;0 allowing jump between layers and 1 smooth. </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;!preference is the assumed resistivity on linear scale. </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;!pref_penalty needs to be put if preference is not 0 [0,1]. </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;! </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;top_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;resistivity&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;penalty&#39;</span><span class="p">,</span> <span class="s1">&#39;preference&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;pref_penalty&#39;</span><span class="p">])))</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">air_layer_height</span><span class="p">),</span>
                                    <span class="s1">&#39;1d12&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;!air layer&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;!first ground layer&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_depth</span><span class="p">:</span>
            <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;{0:</span><span class="si">{1}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ll</span><span class="p">),</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">_string_fmt</span><span class="p">),</span>
                                        <span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>

        <span class="n">modfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote Model file: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.read_model_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Model.read_model_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_model_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        will read in model 1D file</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **modelfn** : full path to model file</span>

<span class="sd">        Fills attributes:</span>
<span class="sd">        --------</span>

<span class="sd">            * model_depth&#39; : depth of model in meters</span>

<span class="sd">            * model_res : value of resisitivity</span>

<span class="sd">            * model_penalty : penalty</span>

<span class="sd">            * model_preference : preference</span>

<span class="sd">            * model_penalty_preference : preference penalty</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; m1 = occam1d.Model()</span>
<span class="sd">            &gt;&gt;&gt; m1.savepath = r&quot;/home/Occam1D/Line1/Inv1_TE&quot;</span>
<span class="sd">            &gt;&gt;&gt; m1.read_model_file()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input a model file&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Could not find</span><span class="si">{0}</span><span class="s1">, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_model_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
        <span class="n">mfid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">mlines</span> <span class="o">=</span> <span class="n">mfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">mfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">mdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;nparam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="s1">&#39;res&#39;</span><span class="p">,</span> <span class="s1">&#39;pen&#39;</span><span class="p">,</span> <span class="s1">&#39;pref&#39;</span><span class="p">,</span> <span class="s1">&#39;prefpen&#39;</span><span class="p">]:</span>
            <span class="n">mdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">mline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">mline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mlst</span> <span class="o">=</span> <span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">mdict</span><span class="p">[</span><span class="n">mlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mlst</span> <span class="o">=</span> <span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span>
                    <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1d12&#39;</span><span class="p">:</span>
                    <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0E12</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;pen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;pref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;prefpen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span> <span class="ow">or</span> <span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span>
                    <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;nparam&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># make everything an array</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="s1">&#39;res&#39;</span><span class="p">,</span> <span class="s1">&#39;pen&#39;</span><span class="p">,</span> <span class="s1">&#39;pref&#39;</span><span class="p">,</span> <span class="s1">&#39;prefpen&#39;</span><span class="p">]:</span>
            <span class="n">mdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mdict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="c1"># create an array with empty columns to put the TE and TM models into</span>
        <span class="n">mres</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">mres</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span>
        <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mres</span>

        <span class="c1"># make attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_res</span> <span class="o">=</span> <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_depth</span> <span class="o">=</span> <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_penalty</span> <span class="o">=</span> <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;pen&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_prefernce</span> <span class="o">=</span> <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;pref&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_preference_penalty</span> <span class="o">=</span> <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;prefpen&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span> <span class="o">=</span> <span class="n">mdict</span><span class="p">[</span><span class="s1">&#39;nparam&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Model.read_iter_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Model.read_iter_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_iter_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read an 1D iteration file</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **imode** : mode to read from</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            **Occam1D.itdict** : dictionary with keys of the header:</span>

<span class="sd">            **model_res** : fills this array with the appropriate</span>
<span class="sd">                            values (0) for data, (1) for model</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; m1 = occam1d.Model()</span>
<span class="sd">            &gt;&gt;&gt; m1.model_fn = r&quot;/home/occam1d/mt01/TE/Model1D&quot;</span>
<span class="sd">            &gt;&gt;&gt; m1.read_iter_file(r&quot;/home/Occam1D/Inv1_TE/M01TE_15.iter&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">iter_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span> <span class="n">iter_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input iteration file&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input a model file&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_model_file</span><span class="p">()</span>

        <span class="n">freeparams</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ifid</span><span class="p">:</span>
            <span class="n">ilines</span> <span class="o">=</span> <span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">model</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ilines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ikey</span> <span class="o">=</span> <span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">ivalue</span> <span class="o">=</span> <span class="n">iline</span><span class="p">[</span><span class="mi">20</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">itdict</span><span class="p">[</span><span class="n">ikey</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ivalue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ilst</span> <span class="o">=</span> <span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">ilst</span><span class="p">:</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="c1"># put the model values into the model dictionary into the res array</span>
        <span class="c1"># for easy manipulation and access.</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_res</span><span class="p">[</span><span class="n">freeparams</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span></div></div>


<div class="viewcode-block" id="Startup"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Startup">[docs]</a><span class="k">class</span> <span class="nc">Startup</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read and write input files for Occam1D</span>

<span class="sd">    ====================== ====================================================</span>
<span class="sd">    Attributes             Description</span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    _ss                    string spacing</span>
<span class="sd">    _startup_fn            basename of startup file *default* is OccamStartup1D</span>
<span class="sd">    data_fn                full path to data file</span>
<span class="sd">    debug_level            debug level *default* is 1</span>
<span class="sd">    description            description of inversion for your self</span>
<span class="sd">                           *default* is 1D_Occam_Inv</span>
<span class="sd">    max_iter               maximum number of iterations *default* is 20</span>
<span class="sd">    model_fn               full path to model file</span>
<span class="sd">    rough_type             roughness type *default* is 1</span>
<span class="sd">    save_path              full path to save files to</span>
<span class="sd">    start_iter             first iteration number *default* is 0</span>
<span class="sd">    start_lagrange         starting lagrange number on log scale</span>
<span class="sd">                           *default* is 5</span>
<span class="sd">    start_misfit           starting misfit value *default* is 100</span>
<span class="sd">    start_rho              starting resistivity value (halfspace) in log scale</span>
<span class="sd">                           *default* is 100</span>
<span class="sd">    start_rough            starting roughness (ignored by Occam1D)</span>
<span class="sd">                           *default* is 1E7</span>
<span class="sd">    startup_fn             full path to startup file</span>
<span class="sd">    target_rms             target rms *default* is 1.0</span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_type&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max_iter&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_rms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;target_rms&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_rho</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;start_rho&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;1D_Occam_Inv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_lagrange</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;start_lagrange&#39;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_rough</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;start_rough&#39;</span><span class="p">,</span> <span class="mf">1.0E7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;debug_level&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_iter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;start_iter&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_misfit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;start_misfit&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_max_bounds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;min_max_bounds&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_step&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_startup_fn</span> <span class="o">=</span> <span class="s1">&#39;OccamStartup1D&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ss</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">3</span>

<div class="viewcode-block" id="Startup.write_startup_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Startup.write_startup_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_startup_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a 1D input file for Occam 1D</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ---------</span>
<span class="sd">            **savepath** : full path to save input file to, if just path then</span>
<span class="sd">                           saved as savepath/input</span>

<span class="sd">            **model_fn** : full path to model file, if None then assumed to be in</span>
<span class="sd">                            savepath/model.mod</span>

<span class="sd">            **data_fn** : full path to data file, if None then assumed to be</span>
<span class="sd">                            in savepath/TE.dat or TM.dat</span>

<span class="sd">            **rough_type** : roughness type. *default* = 0</span>

<span class="sd">            **max_iter** : maximum number of iterations. *default* = 20</span>

<span class="sd">            **target_rms** : target rms value. *default* = 1.0</span>

<span class="sd">            **start_rho** : starting resistivity value on linear scale.</span>
<span class="sd">                            *default* = 100</span>

<span class="sd">            **description** : description of the inversion.</span>

<span class="sd">            **start_lagrange** : starting Lagrange multiplier for smoothness.</span>
<span class="sd">                           *default* = 5</span>

<span class="sd">            **start_rough** : starting roughness value. *default* = 1E7</span>

<span class="sd">            **debuglevel** : something to do with how Fortran debuggs the code</span>
<span class="sd">                             Almost always leave at *default* = 1</span>

<span class="sd">            **start_iter** : the starting iteration number, handy if the</span>
<span class="sd">                            starting model is from a previous run.</span>
<span class="sd">                            *default* = 0</span>

<span class="sd">            **start_misfit** : starting misfit value. *default* = 100</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            **Occam1D.inputfn** : full path to input file.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; old = occam.Occam1D()</span>
<span class="sd">            &gt;&gt;&gt; old.make1DdataFile(&#39;MT01&#39;,edipath=r&quot;/home/Line1&quot;,</span>
<span class="sd">            &gt;&gt;&gt;                    savepath=r&quot;/home/Occam1D/Line1/Inv1_TE&quot;,</span>
<span class="sd">            &gt;&gt;&gt;                    mode=&#39;TE&#39;)</span>
<span class="sd">            &gt;&gt;&gt; Wrote Data File: /home/Occam1D/Line1/Inv1_TE/MT01TE.dat</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; old.make1DModelFile(savepath=r&quot;/home/Occam1D/Line1/Inv1_TE&quot;,</span>
<span class="sd">            &gt;&gt;&gt;                     nlayers=50,bottomlayer=10000,z1layer=50)</span>
<span class="sd">            &gt;&gt;&gt; Wrote Model file: /home/Occam1D/Line1/Inv1_TE/Model1D</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; old.make1DInputFile(rhostart=10,targetrms=1.5,maxiter=15)</span>
<span class="sd">            &gt;&gt;&gt; Wrote Input File: /home/Occam1D/Line1/Inv1_TE/Input1D</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startup_fn</span><span class="p">)</span>

        <span class="c1"># --&gt; read data file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input data file name.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="c1"># --&gt; read model file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input model file name.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
            <span class="n">model</span><span class="o">.</span><span class="n">read_model_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>

            <span class="c1"># --&gt; get any keywords</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

            <span class="c1"># --&gt; write input file</span>
        <span class="n">infid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Format:&#39;</span><span class="p">,</span> <span class="s1">&#39;OCCAMITER_FLEX&#39;</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Description:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model File:&#39;</span><span class="p">,</span>
                                          <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Data File:&#39;</span><span class="p">,</span>
                                          <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Date/Time:&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Max Iter:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Target Misfit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rms</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Roughness Type:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rough_type</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_max_bounds</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;!Model Bounds:&#39;</span><span class="p">,</span> <span class="s1">&#39;min,max&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="s1">,</span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model Bounds:&#39;</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">min_max_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">min_max_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_step</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;!Model Value Steps:&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;stepsize&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model Value Steps:&#39;</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">model_step</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Debug Level:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Iteration:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_iter</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Lagrange Value:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_lagrange</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Roughness Value:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_rough</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Misfit Value:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_misfit</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Misfit Reached:&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;21}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Param Count:&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">num_params</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">num_params</span><span class="p">):</span>
            <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}{1:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ss</span><span class="p">,</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_rho</span><span class="p">)))</span>

        <span class="n">infid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span> <span class="s1">&#39;Wrote Input File: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Startup.read_startup_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Startup.read_startup_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_startup_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startup_fn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads in a 1D input file</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ---------</span>
<span class="sd">            **inputfn** : full path to input file</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            **Occam1D.indict** : dictionary with keys following the header and</span>

<span class="sd">                *&#39;res&#39;* : an array of resistivity values</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; old = occam.Occam1d()</span>
<span class="sd">            &gt;&gt;&gt; old.savepath = r&quot;/home/Occam1D/Line1/Inv1_TE&quot;</span>
<span class="sd">            &gt;&gt;&gt; old.read1DInputFile()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">startup_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">startup_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input a startup file.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_startup_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span>

        <span class="n">infid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ilines</span> <span class="o">=</span> <span class="n">infid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># split the keys and values from the header information</span>
        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="n">ilines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ikey</span> <span class="o">=</span> <span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ivalue</span> <span class="o">=</span> <span class="n">iline</span><span class="p">[</span><span class="mi">20</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ikey</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ikey</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">),</span> <span class="n">ivalue</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indict</span><span class="p">[</span><span class="n">ikey</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ivalue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="c1"># make the resistivity array ready for models to be input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span></div></div>


<div class="viewcode-block" id="Plot1DResponse"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Plot1DResponse">[docs]</a><span class="k">class</span> <span class="nc">Plot1DResponse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot the 1D response and model.  Plots apparent resisitivity and phase</span>
<span class="sd">    in different subplots with the model on the far right.  You can plot both</span>
<span class="sd">    TE and TM modes together along with different iterations of the model.</span>
<span class="sd">    These will be plotted in different colors or shades of gray depneng on</span>
<span class="sd">    color_scale.</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.occam1d as occam1d</span>
<span class="sd">        &gt;&gt;&gt; p1 = occam1d.Plot1DResponse(plot_yn=&#39;n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; p1.data_te_fn = r&quot;/home/occam1d/mt01/TE/Occam_DataFile_TE.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; p1.data_tm_fn = r&quot;/home/occam1d/mt01/TM/Occam_DataFile_TM.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; p1.model_fn = r&quot;/home/occam1d/mt01/TE/Model1D&quot;</span>
<span class="sd">        &gt;&gt;&gt; p1.iter_te_fn = [r&quot;/home/occam1d/mt01/TE/TE_{0}.iter&quot;.format(ii)</span>
<span class="sd">        &gt;&gt;&gt; ...              for ii in range(5,10)]</span>
<span class="sd">        &gt;&gt;&gt; p1.iter_tm_fn = [r&quot;/home/occam1d/mt01/TM/TM_{0}.iter&quot;.format(ii)</span>
<span class="sd">        &gt;&gt;&gt; ...              for ii in range(5,10)]</span>
<span class="sd">        &gt;&gt;&gt; p1.resp_te_fn = [r&quot;/home/occam1d/mt01/TE/TE_{0}.resp&quot;.format(ii)</span>
<span class="sd">        &gt;&gt;&gt; ...              for ii in range(5,10)]</span>
<span class="sd">        &gt;&gt;&gt; p1.resp_tm_fn = [r&quot;/home/occam1d/mt01/TM/TM_{0}.resp&quot;.format(ii)</span>
<span class="sd">        &gt;&gt;&gt; ...              for ii in range(5,10)]</span>
<span class="sd">        &gt;&gt;&gt; p1.plot()</span>

<span class="sd">    ==================== ======================================================</span>
<span class="sd">    Attributes           Description</span>
<span class="sd">    ==================== ======================================================</span>
<span class="sd">    axm                  matplotlib.axes instance for model subplot</span>
<span class="sd">    axp                  matplotlib.axes instance for phase subplot</span>
<span class="sd">    axr                  matplotlib.axes instance for app. res subplot</span>
<span class="sd">    color_mode           [ &#39;color&#39; | &#39;bw&#39; ]</span>
<span class="sd">    cted                 color of TE data markers</span>
<span class="sd">    ctem                 color of TM data markers</span>
<span class="sd">    ctmd                 color of TE model markers</span>
<span class="sd">    ctmm                 color of TM model markers</span>
<span class="sd">    data_te_fn           full path to data file for TE mode</span>
<span class="sd">    data_tm_fn           full path to data file for TM mode</span>
<span class="sd">    depth_limits         (min, max) limits for depth plot in depth_units</span>
<span class="sd">    depth_scale          [ &#39;log&#39; | &#39;linear&#39; ] *default* is linear</span>
<span class="sd">    depth_units          [ &#39;m&#39; | &#39;km&#39; ] *default is &#39;km&#39;</span>
<span class="sd">    e_capsize            capsize of error bars</span>
<span class="sd">    e_capthick           cap thickness of error bars</span>
<span class="sd">    fig                  matplotlib.figure instance for plot</span>
<span class="sd">    fig_dpi              resolution in dots-per-inch for figure</span>
<span class="sd">    fig_num              number of figure instance</span>
<span class="sd">    fig_size             size of figure in inches [width, height]</span>
<span class="sd">    font_size            size of axes tick labels, axes labels are +2</span>
<span class="sd">    grid_alpha           transparency of grid</span>
<span class="sd">    grid_color           color of grid</span>
<span class="sd">    iter_te_fn           full path or list of .iter files for TE mode</span>
<span class="sd">    iter_tm_fn           full path or list of .iter files for TM mode</span>
<span class="sd">    lw                   width of lines for model</span>
<span class="sd">    model_fn             full path to model file</span>
<span class="sd">    ms                   marker size</span>
<span class="sd">    mted                 marker for TE data</span>
<span class="sd">    mtem                 marker for TM data</span>
<span class="sd">    mtmd                 marker for TE model</span>
<span class="sd">    mtmm                 marker for TM model</span>
<span class="sd">    phase_limits         (min, max) limits on phase in degrees</span>
<span class="sd">    phase_major_ticks    spacing for major ticks in phase</span>
<span class="sd">    phase_minor_ticks    spacing for minor ticks in phase</span>
<span class="sd">    plot_yn              [ &#39;y&#39; | &#39;n&#39; ] plot on instantiation</span>
<span class="sd">    res_limits           limits of resistivity in linear scale</span>
<span class="sd">    resp_te_fn           full path or list of .resp files for TE mode</span>
<span class="sd">    resp_tm_fn           full path or list of .iter files for TM mode</span>
<span class="sd">    subplot_bottom       spacing of subplots from bottom of figure</span>
<span class="sd">    subplot_hspace       height spacing between subplots</span>
<span class="sd">    subplot_left         spacing of subplots from left of figure</span>
<span class="sd">    subplot_right        spacing of subplots from right of figure</span>
<span class="sd">    subplot_top          spacing of subplots from top of figure</span>
<span class="sd">    subplot_wspace       width spacing between subplots</span>
<span class="sd">    title_str            title of plot</span>
<span class="sd">    ==================== ======================================================</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_te_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_tm_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">resp_te_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resp_tm_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iter_te_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">iter_tm_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_te_fn</span> <span class="o">=</span> <span class="n">data_te_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_tm_fn</span> <span class="o">=</span> <span class="n">data_tm_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resp_te_fn</span> <span class="o">=</span> <span class="n">resp_te_fn</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_te_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp_te_fn</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_te_fn</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resp_tm_fn</span> <span class="o">=</span> <span class="n">resp_tm_fn</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_tm_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp_tm_fn</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_tm_fn</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iter_te_fn</span> <span class="o">=</span> <span class="n">iter_te_fn</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_te_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_te_fn</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_te_fn</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iter_tm_fn</span> <span class="o">=</span> <span class="n">iter_tm_fn</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_tm_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_tm_fn</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_tm_fn</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;color_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ls</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;e_capthick&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;e_capsize&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_major_ticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_major_ticks&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_minor_ticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_minor_ticks&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;grid_color&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;grid_alpha&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># color mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span>
            <span class="c1"># color for data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmd&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mted&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmd&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

            <span class="c1"># color for occam2d model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctem&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtem&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmm&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>

        <span class="c1"># black and white mode</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;bw&#39;</span><span class="p">:</span>
            <span class="c1"># color for data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmd&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mted&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmd&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">)</span>

            <span class="c1"># color for occam2d model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctem&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtem&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmm&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_limits&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;depth_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;depth_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_units</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;depth_units&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axm</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">92</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">085</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">93</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">title_str</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title_str&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<div class="viewcode-block" id="Plot1DResponse.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Plot1DResponse.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot data, response and model</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_te_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp_te_fn</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_te_fn</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_tm_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp_tm_fn</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_tm_fn</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_te_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_te_fn</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_te_fn</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_tm_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_tm_fn</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_tm_fn</span><span class="p">]</span>

        <span class="c1"># make a grid of subplots</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                               <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">)</span>

        <span class="c1"># make a figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

        <span class="c1"># set some plot parameters</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span>

        <span class="c1"># subplot resistivity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">])</span>

        <span class="c1"># subplot for phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">4</span><span class="p">:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="p">)</span>

        <span class="c1"># subplot for model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">])</span>

        <span class="n">legend_marker_list_te</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">legend_label_list_te</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">legend_marker_list_tm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">legend_label_list_tm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># --&gt; plot data apparent resistivity and phase-------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_te_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
            <span class="n">d1</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_te_fn</span><span class="p">)</span>

            <span class="c1"># --&gt; cut out missing data</span>
            <span class="n">rxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">res_te</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># --&gt; TE mode Data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rxy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">d1</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span>
                                        <span class="n">d1</span><span class="o">.</span><span class="n">res_te</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span>
                                        <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">,</span>
                                        <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                        <span class="n">mfc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                        <span class="n">mec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                        <span class="n">yerr</span><span class="o">=</span><span class="n">d1</span><span class="o">.</span><span class="n">res_te</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                        <span class="n">ecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                        <span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                        <span class="n">elinewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                        <span class="n">capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                        <span class="n">capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
                <span class="n">legend_marker_list_te</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">legend_label_list_te</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Obs_</span><span class="si">{TE}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># --------------------plot phase--------------------------------</span>
            <span class="c1"># cut out missing data points first</span>
            <span class="n">pxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">phase_te</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># --&gt; TE mode data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">d1</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span>
                                  <span class="n">d1</span><span class="o">.</span><span class="n">phase_te</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span>
                                  <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">,</span>
                                  <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                  <span class="n">mfc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                  <span class="n">mec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                  <span class="n">yerr</span><span class="o">=</span><span class="n">d1</span><span class="o">.</span><span class="n">phase_te</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                                  <span class="n">ecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                  <span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                  <span class="n">elinewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                  <span class="n">capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                  <span class="n">capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># --&gt; plot tm data------------------------------------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_tm_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
            <span class="n">d1</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_tm_fn</span><span class="p">)</span>

            <span class="n">ryx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">res_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># --&gt; TM mode data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ryx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rtm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">d1</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span>
                                        <span class="n">d1</span><span class="o">.</span><span class="n">res_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span>
                                        <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">,</span>
                                        <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                        <span class="n">mfc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                        <span class="n">mec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                        <span class="n">yerr</span><span class="o">=</span><span class="n">d1</span><span class="o">.</span><span class="n">res_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                        <span class="n">ecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                        <span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                        <span class="n">elinewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                        <span class="n">capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                        <span class="n">capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
                <span class="n">legend_marker_list_tm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">legend_label_list_tm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Obs_</span><span class="si">{TM}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

                <span class="c1"># --------------------plot phase--------------------------------</span>
            <span class="c1"># cut out missing data points first</span>
            <span class="n">pyx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">phase_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># --&gt; TM mode data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">d1</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span>
                                  <span class="n">d1</span><span class="o">.</span><span class="n">phase_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span>
                                  <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">,</span>
                                  <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                  <span class="n">mfc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                  <span class="n">mec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                  <span class="n">yerr</span><span class="o">=</span><span class="n">d1</span><span class="o">.</span><span class="n">phase_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                                  <span class="n">ecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                  <span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                  <span class="n">elinewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                  <span class="n">capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                  <span class="n">capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># --&gt; plot model apparent resistivity and phase-------------------------</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_te_fn</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rr</span><span class="p">,</span> <span class="n">rfn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_te_fn</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rfn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">itnum</span> <span class="o">=</span> <span class="n">rfn</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span>
                <span class="n">cxy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">4</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">nr</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;bw&#39;</span><span class="p">:</span>
                <span class="n">cxy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">))</span>

            <span class="n">d1</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>

            <span class="n">d1</span><span class="o">.</span><span class="n">read_resp_file</span><span class="p">(</span><span class="n">rfn</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_te_fn</span><span class="p">)</span>

            <span class="c1"># get non zero data</span>
            <span class="n">rxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">res_te</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># --&gt; TE mode Data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rxy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">d1</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span>
                                        <span class="n">d1</span><span class="o">.</span><span class="n">res_te</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span>
                                        <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtem</span><span class="p">,</span>
                                        <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                        <span class="n">mfc</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                        <span class="n">mec</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                        <span class="n">yerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="n">ecolor</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                        <span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                        <span class="n">elinewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                        <span class="n">capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                        <span class="n">capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
                <span class="n">legend_marker_list_te</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">legend_label_list_te</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Mod_</span><span class="si">{TE}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="n">itnum</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># --------------------plot phase--------------------------------</span>
            <span class="c1"># cut out missing data points first</span>
            <span class="c1"># --&gt; data</span>
            <span class="n">pxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">phase_te</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># --&gt; TE mode phase</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">d1</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span>
                                  <span class="n">d1</span><span class="o">.</span><span class="n">phase_te</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span>
                                  <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtem</span><span class="p">,</span>
                                  <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                  <span class="n">mfc</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                  <span class="n">mec</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                  <span class="n">yerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">ecolor</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                  <span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                  <span class="n">elinewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                  <span class="n">capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                  <span class="n">capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># ---------------plot TM model response---------------------------------</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_tm_fn</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rr</span><span class="p">,</span> <span class="n">rfn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_tm_fn</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rfn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">itnum</span> <span class="o">=</span> <span class="n">rfn</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span>
                <span class="n">cyx</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">7</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">nr</span><span class="p">),</span> <span class="o">.</span><span class="mi">13</span><span class="p">,</span> <span class="o">.</span><span class="mi">63</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">nr</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;bw&#39;</span><span class="p">:</span>
                <span class="n">cyx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">))</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>

            <span class="n">d1</span><span class="o">.</span><span class="n">read_resp_file</span><span class="p">(</span><span class="n">rfn</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_tm_fn</span><span class="p">)</span>
            <span class="n">ryx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">res_tm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># --&gt; TM mode model</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ryx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rtm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">d1</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span>
                                        <span class="n">d1</span><span class="o">.</span><span class="n">res_tm</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span>
                                        <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span><span class="p">,</span>
                                        <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                        <span class="n">mfc</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                        <span class="n">mec</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                        <span class="n">yerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="n">ecolor</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                        <span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                        <span class="n">elinewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                        <span class="n">capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                        <span class="n">capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
                <span class="n">legend_marker_list_tm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">legend_label_list_tm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Mod_</span><span class="si">{TM}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="n">itnum</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">pyx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">phase_tm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># --&gt; TM mode model</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">d1</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span>
                                  <span class="n">d1</span><span class="o">.</span><span class="n">phase_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">,</span>
                                  <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span><span class="p">,</span>
                                  <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                  <span class="n">mfc</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                  <span class="n">mec</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                  <span class="n">yerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">ecolor</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                  <span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                  <span class="n">elinewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                  <span class="n">capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                  <span class="n">capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># --&gt; set axis properties-----------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposx</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposx</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_alpha</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_color</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_alpha</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_major_ticks</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_minor_ticks</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title_str</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend_marker_list_te</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">legend_marker_list_tm</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">num_col</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_col</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_marker_list_te</span> <span class="o">+</span> <span class="n">legend_marker_list_tm</span><span class="p">,</span>
                        <span class="n">legend_label_list_te</span> <span class="o">+</span> <span class="n">legend_label_list_tm</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">borderaxespad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                        <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                        <span class="n">borderpad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                        <span class="n">ncol</span><span class="o">=</span><span class="n">num_col</span><span class="p">,</span>
                        <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>

        <span class="c1"># --&gt; plot depth model--------------------------------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># put axis labels on the right side for clarity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s1">&#39;on&#39;</span><span class="p">,</span>
                                           <span class="n">labelright</span><span class="o">=</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_units</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
                <span class="n">dscale</span> <span class="o">=</span> <span class="mf">1000.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dscale</span> <span class="o">=</span> <span class="mf">1.</span>

            <span class="c1"># --&gt; plot te models</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_te_fn</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">ifn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_te_fn</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ifn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span>
                    <span class="n">cxy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">4</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">nr</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;bw&#39;</span><span class="p">:</span>
                    <span class="n">cxy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">))</span>
                <span class="n">m1</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
                <span class="n">m1</span><span class="o">.</span><span class="n">read_iter_file</span><span class="p">(</span><span class="n">ifn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
                <span class="n">plot_depth</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">model_depth</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">dscale</span>
                <span class="n">plot_model</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">m1</span><span class="o">.</span><span class="n">model_res</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">plot_model</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">plot_depth</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;steps-&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                  <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>

            <span class="c1"># --&gt; plot TM models</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_tm_fn</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">ifn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_tm_fn</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ifn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span>
                    <span class="n">cyx</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">7</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">nr</span><span class="p">),</span> <span class="o">.</span><span class="mi">13</span><span class="p">,</span> <span class="o">.</span><span class="mi">63</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">nr</span><span class="p">))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;bw&#39;</span><span class="p">:</span>
                    <span class="n">cyx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">))</span>
                <span class="n">m1</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
                <span class="n">m1</span><span class="o">.</span><span class="n">read_iter_file</span><span class="p">(</span><span class="n">ifn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
                <span class="n">plot_depth</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">model_depth</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">dscale</span>
                <span class="n">plot_model</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">m1</span><span class="o">.</span><span class="n">model_res</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">plot_model</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">plot_depth</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;steps-&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                  <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>

            <span class="n">m1</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
            <span class="n">m1</span><span class="o">.</span><span class="n">read_model_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">plot_depth</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dmin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dmin</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">dmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">plot_depth</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth_limits</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_limits</span><span class="p">),</span>
                              <span class="n">ymax</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_limits</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_units</span><span class="p">),</span>
                                <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Resistivity ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                                <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axm</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Plot1DResponse.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Plot1DResponse.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; #change line width</span>
<span class="sd">            &gt;&gt;&gt; p1.lw = 2</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="Plot1DResponse.update_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Plot1DResponse.update_plot">[docs]</a>    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update any parameters that where changed using the built-in draw from</span>
<span class="sd">        canvas.</span>

<span class="sd">        Use this if you change an of the .fig or axes properties</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to change the grid lines to only be on the major ticks</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; [ax.grid(True, which=&#39;major&#39;) for ax in [ps1.axrte,ps1.axtep]]</span>
<span class="sd">            &gt;&gt;&gt; ps1.update_plot()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="Plot1DResponse.save_figure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Plot1DResponse.save_figure">[docs]</a>    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span>
                    <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_plot</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save_plot will save the figure to save_fn.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>

<span class="sd">            **save_fn** : string</span>
<span class="sd">                          full path to save figure to, can be input as</span>
<span class="sd">                          * directory path -&gt; the directory path to save to</span>
<span class="sd">                            in which the file will be saved as</span>
<span class="sd">                            save_fn/station_name_PhaseTensor.file_format</span>

<span class="sd">                          * full path -&gt; file will be save to the given</span>
<span class="sd">                            path.  If you use this option then the format</span>
<span class="sd">                            will be assumed to be provided by the path</span>

<span class="sd">            **file_format** : [ pdf | eps | jpg | png | svg ]</span>
<span class="sd">                              file type of saved figure pdf,svg,eps...</span>

<span class="sd">            **orientation** : [ landscape | portrait ]</span>
<span class="sd">                              orientation in which the file will be saved</span>
<span class="sd">                              *default* is portrait</span>

<span class="sd">            **fig_dpi** : int</span>
<span class="sd">                          The resolution in dots-per-inch the file will be</span>
<span class="sd">                          saved.  If None then the dpi will be that at</span>
<span class="sd">                          which the figure was made.  I don&#39;t think that</span>
<span class="sd">                          it can be larger than dpi of the figure.</span>

<span class="sd">            **close_plot** : [ y | n ]</span>
<span class="sd">                             * &#39;y&#39; will close the plot after saving.</span>
<span class="sd">                             * &#39;n&#39; will leave plot open</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to save plot as jpg</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; ps1.save_plot(r&#39;/home/MT/figures&#39;, file_format=&#39;jpg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig_dpi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">):</span>
            <span class="n">file_format</span> <span class="o">=</span> <span class="n">save_fn</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;Occam1d.&#39;</span> <span class="o">+</span>
                                   <span class="n">file_format</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_plot</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span> <span class="o">=</span> <span class="n">save_fn</span>
        <span class="nb">print</span> <span class="s1">&#39;Saved figure to: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewrite the string builtin to give a useful message</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;Plots model responses and model for 1D occam inversion&quot;</span></div>


<div class="viewcode-block" id="Run"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.Run">[docs]</a><span class="k">class</span> <span class="nc">Run</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    run occam 1d from python given the correct files and location of occam1d</span>
<span class="sd">    executable</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startup_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">occam_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">startup_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occam_path</span> <span class="o">=</span> <span class="n">occam_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;TE&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_occam1d</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run_occam1d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input startup file&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input path to occam1d executable&#39;</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">))</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">occam_path</span><span class="p">,</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">test</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;=========== Ran Inversion ==========&#39;</span>
            <span class="nb">print</span> <span class="s1">&#39;  check </span><span class="si">{0}</span><span class="s1"> for files&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">))</span></div>


<div class="viewcode-block" id="PlotL2"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.PlotL2">[docs]</a><span class="k">class</span> <span class="nc">PlotL2</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot L2 curve of iteration vs rms and roughness</span>

<span class="sd">    Arguments:</span>
<span class="sd">    ----------</span>
<span class="sd">        **rms_arr** : structured array with keys:</span>
<span class="sd">                      * &#39;iteration&#39; --&gt; for iteration number (int)</span>
<span class="sd">                      * &#39;rms&#39; --&gt; for rms (float)</span>
<span class="sd">                      * &#39;roughness&#39; --&gt; for roughness (float)</span>

<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Keywords/attributes     Description</span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    ax1                     matplotlib.axes instance for rms vs iteration</span>
<span class="sd">    ax2                     matplotlib.axes instance for roughness vs rms</span>
<span class="sd">    fig                     matplotlib.figure instance</span>
<span class="sd">    fig_dpi                 resolution of figure in dots-per-inch</span>
<span class="sd">    fig_num                 number of figure instance</span>
<span class="sd">    fig_size                size of figure in inches (width, height)</span>
<span class="sd">    font_size               size of axes tick labels, axes labels is +2</span>
<span class="sd">    plot_yn                 [ &#39;y&#39; | &#39;n&#39;]</span>
<span class="sd">                            &#39;y&#39; --&gt; to plot on instantiation</span>
<span class="sd">                            &#39;n&#39; --&gt; to not plot on instantiation</span>
<span class="sd">    rms_arr                 structure np.array as described above</span>
<span class="sd">    rms_color               color of rms marker and line</span>
<span class="sd">    rms_lw                  line width of rms line</span>
<span class="sd">    rms_marker              marker for rms values</span>
<span class="sd">    rms_marker_size         size of marker for rms values</span>
<span class="sd">    rms_mean_color          color of mean line</span>
<span class="sd">    rms_median_color        color of median line</span>
<span class="sd">    rough_color             color of roughness line and marker</span>
<span class="sd">    rough_font_size         font size for iteration number inside roughness</span>
<span class="sd">                            marker</span>
<span class="sd">    rough_lw                line width for roughness line</span>
<span class="sd">    rough_marker            marker for roughness</span>
<span class="sd">    rough_marker_size       size of marker for roughness</span>
<span class="sd">    subplot_bottom          subplot spacing from bottom</span>
<span class="sd">    subplot_left            subplot spacing from left</span>
<span class="sd">    subplot_right           subplot spacing from right</span>
<span class="sd">    subplot_top             subplot spacing from top</span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    =================== =======================================================</span>
<span class="sd">    Methods             Description</span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    plot                plots L2 curve.</span>
<span class="sd">    redraw_plot         call redraw_plot to redraw the figures,</span>
<span class="sd">                        if one of the attributes has been changed</span>
<span class="sd">    save_figure         saves the matplotlib.figure instance to desired</span>
<span class="sd">                        location and format</span>
<span class="sd">    =================== ======================================================</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">model_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span> <span class="o">=</span> <span class="n">dir_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_iter_list</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">98</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">085</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">91</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rms_lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_lw&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_marker&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_marker_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_marker_size&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_median_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_median_color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_mean_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_mean_color&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rough_lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_lw&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_marker&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_color&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_marker_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_marker_size&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_font_size&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_iter_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get all iteration files in dir_path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Could not find </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="p">))</span>

        <span class="n">iter_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="p">)</span>
                     <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.iter&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_list</span><span class="p">),</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;iteration&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;rms&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;roughness&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)]))</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iter_list</span><span class="p">):</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
            <span class="n">m1</span><span class="o">.</span><span class="n">read_iter_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;iteration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">itdict</span><span class="p">[</span><span class="s1">&#39;Iteration&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;rms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">itdict</span><span class="p">[</span><span class="s1">&#39;Misfit Value&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;roughness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">itdict</span><span class="p">[</span><span class="s1">&#39;Roughness Value&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;iteration&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="PlotL2.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.PlotL2.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot L2 curve</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">med_rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">])</span>
        <span class="n">mean_rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">])</span>

        <span class="c1"># set the dimesions of the figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span>

        <span class="c1"># make figure instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

        <span class="c1"># make a subplot for RMS vs Iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># plot the rms vs iteration</span>
        <span class="n">l1</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;-k&#39;</span><span class="p">,</span>
                            <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span>
                            <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># plot the median of the RMS</span>
        <span class="n">m1</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">med_rms</span><span class="p">,</span> <span class="n">nr</span><span class="p">),</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_median_color</span><span class="p">,</span>
                            <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_lw</span> <span class="o">*</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span>

        <span class="c1"># plot the mean of the RMS</span>
        <span class="n">m2</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mean_rms</span><span class="p">,</span> <span class="n">nr</span><span class="p">),</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_mean_color</span><span class="p">,</span>
                            <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_lw</span> <span class="o">*</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span>

        <span class="c1"># make subplot for RMS vs Roughness Plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># plot the rms vs roughness</span>
        <span class="n">l2</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">],</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span><span class="p">,</span>
                            <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_lw</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_marker</span><span class="p">,</span>
                            <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_marker_size</span><span class="p">,</span>
                            <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

        <span class="c1"># plot the iteration number inside the roughness marker</span>
        <span class="k">for</span> <span class="n">rms</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">rough</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">]):</span>
            <span class="c1"># need this because if the roughness is larger than this number</span>
            <span class="c1"># matplotlib puts the text out of bounds and a draw_text_image</span>
            <span class="c1"># error is raised and file cannot be saved, also the other</span>
            <span class="c1"># numbers are not put in.</span>
            <span class="k">if</span> <span class="n">rough</span> <span class="o">&gt;</span> <span class="mf">1e8</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rough</span><span class="p">,</span>
                              <span class="n">rms</span><span class="p">,</span>
                              <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span>
                              <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                              <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rough_font_size</span><span class="p">,</span>
                                        <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span><span class="p">})</span>

        <span class="c1"># make a legend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span>
                        <span class="p">[</span><span class="s1">&#39;RMS&#39;</span><span class="p">,</span> <span class="s1">&#39;Roughness&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Median_RMS=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">med_rms</span><span class="p">),</span>
                         <span class="s1">&#39;Mean_RMS=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean_rms</span><span class="p">)],</span>
                        <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                        <span class="n">columnspacing</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                        <span class="n">markerscale</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># set the axis properties for RMS vs iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RMS&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                      <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                      <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_lw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Roughness&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                      <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span><span class="p">})</span>

        <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t2</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotL2.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.PlotL2.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; #change line width</span>
<span class="sd">            &gt;&gt;&gt; p1.lw = 2</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotL2.save_figure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.PlotL2.save_figure">[docs]</a>    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span>
                    <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_fig</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save_plot will save the figure to save_fn.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>

<span class="sd">            **save_fn** : string</span>
<span class="sd">                          full path to save figure to, can be input as</span>
<span class="sd">                          * directory path -&gt; the directory path to save to</span>
<span class="sd">                            in which the file will be saved as</span>
<span class="sd">                            save_fn/station_name_PhaseTensor.file_format</span>

<span class="sd">                          * full path -&gt; file will be save to the given</span>
<span class="sd">                            path.  If you use this option then the format</span>
<span class="sd">                            will be assumed to be provided by the path</span>

<span class="sd">            **file_format** : [ pdf | eps | jpg | png | svg ]</span>
<span class="sd">                              file type of saved figure pdf,svg,eps...</span>

<span class="sd">            **orientation** : [ landscape | portrait ]</span>
<span class="sd">                              orientation in which the file will be saved</span>
<span class="sd">                              *default* is portrait</span>

<span class="sd">            **fig_dpi** : int</span>
<span class="sd">                          The resolution in dots-per-inch the file will be</span>
<span class="sd">                          saved.  If None then the dpi will be that at</span>
<span class="sd">                          which the figure was made.  I don&#39;t think that</span>
<span class="sd">                          it can be larger than dpi of the figure.</span>

<span class="sd">            **close_plot** : [ y | n ]</span>
<span class="sd">                             * &#39;y&#39; will close the plot after saving.</span>
<span class="sd">                             * &#39;n&#39; will leave plot open</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to save plot as jpg</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; ps1.save_plot(r&#39;/home/MT/figures&#39;, file_format=&#39;jpg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig_dpi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">file_format</span> <span class="o">=</span> <span class="n">save_fn</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;_L2.&#39;</span> <span class="o">+</span>
                                   <span class="n">file_format</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_fig</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span> <span class="o">=</span> <span class="n">save_fn</span>
        <span class="nb">print</span> <span class="s1">&#39;Saved figure to: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span></div>

<div class="viewcode-block" id="PlotL2.update_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.PlotL2.update_plot">[docs]</a>    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update any parameters that where changed using the built-in draw from</span>
<span class="sd">        canvas.</span>

<span class="sd">        Use this if you change an of the .fig or axes properties</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to change the grid lines to only be on the major ticks</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; [ax.grid(True, which=&#39;major&#39;) for ax in [ps1.axrte,ps1.axtep]]</span>
<span class="sd">            &gt;&gt;&gt; ps1.update_plot()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewrite the string builtin to give a useful message</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;Plots RMS vs Iteration computed by Occam2D&quot;</span></div>


<div class="viewcode-block" id="parse_arguments"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.parse_arguments">[docs]</a><span class="k">def</span> <span class="nf">parse_arguments</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    takes list of command line arguments obtained by passing in sys.argv</span>
<span class="sd">    reads these and returns a parser object</span>

<span class="sd">    author: Alison Kirkby (2016)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">argparse</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Set up and run a set of isotropic occam1d model runs&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;edipath&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;folder containing edi files to use, full path or relative to working directory&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="s1">&#39;--program_location&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;path to the inversion program&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;/home/547/alk547/occam1d/OCCAM1DCSEM&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-efr&#39;</span><span class="p">,</span> <span class="s1">&#39;--resistivity_errorfloor&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;error floor in resistivity, percent&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-efp&#39;</span><span class="p">,</span> <span class="s1">&#39;--phase_errorfloor&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;error floor in phase, degrees&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-efz&#39;</span><span class="p">,</span> <span class="s1">&#39;--z_errorfloor&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;error floor in z, percent&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-wd&#39;</span><span class="p">,</span> <span class="s1">&#39;--working_directory&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;working directory&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;--modes&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;modes to run, any or all of TE, TM, det (determinant)&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">])</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--rotation_angle&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;angle to rotate the data by, in degrees or can define option &quot;strike&quot; to rotate to strike, or &quot;file&quot; to get rotation angle from file&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-rfile&#39;</span><span class="p">,</span> <span class="s1">&#39;--rotation_angle_file&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;file containing rotation angles, first column is station name (must match edis) second column is rotation angle&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-spr&#39;</span><span class="p">,</span> <span class="s1">&#39;--strike_period_range&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;period range to use for calculation of strike if rotating to strike, two floats&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">])</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-sapp&#39;</span><span class="p">,</span> <span class="s1">&#39;--strike_approx&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;approximate strike angle, the strike closest to this value is chosen&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-q&#39;</span><span class="p">,</span> <span class="s1">&#39;--remove_outofquadrant&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;whether or not to remove points outside of the first or third quadrant, True or False&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-itermax&#39;</span><span class="p">,</span> <span class="s1">&#39;--iteration_max&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;maximum number of iterations&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-rf&#39;</span><span class="p">,</span> <span class="s1">&#39;--rms_factor&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;factor to multiply the minimum possible rms by to get the target rms for the second run&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-nl&#39;</span><span class="p">,</span> <span class="s1">&#39;--n_layers&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of layers in the inversion&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-td&#39;</span><span class="p">,</span> <span class="s1">&#39;--target_depth&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;target depth for the inversion in metres&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="s1">&#39;--master_savepath&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;master directory to save suite of runs into&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;inversion_suite&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
    <span class="n">args</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">working_directory</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;strike&#39;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="k">return</span> <span class="n">args</span></div>


<div class="viewcode-block" id="update_inputs"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.update_inputs">[docs]</a><span class="k">def</span> <span class="nf">update_inputs</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    update input parameters from command line</span>

<span class="sd">    author: Alison Kirkby (2016)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sys</span> <span class="k">import</span> <span class="n">argv</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_arguments</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">cline_inputs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cline_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cline_keys</span><span class="p">:</span>
        <span class="n">cline_inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cline_inputs</span></div>


<div class="viewcode-block" id="get_strike"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.get_strike">[docs]</a><span class="k">def</span> <span class="nf">get_strike</span><span class="p">(</span><span class="n">mt_object</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">strike_approx</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the strike from the z array, choosing the strike angle that is closest</span>
<span class="sd">    to the azimuth of the PT ellipse (PT strike).</span>

<span class="sd">    if there is not strike available from the z array use the PT strike.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fselect</span> <span class="o">=</span> <span class="p">(</span><span class="n">mt_object</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="n">fmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mt_object</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span> <span class="o">&lt;</span> <span class="n">fmax</span><span class="p">)</span>

    <span class="c1"># get median strike angles for frequencies needed (two strike angles due to 90 degree ambiguity)</span>
    <span class="n">zstrike</span> <span class="o">=</span> <span class="n">mtg</span><span class="o">.</span><span class="n">strike_angle</span><span class="p">(</span><span class="n">z_object</span><span class="o">=</span><span class="n">mt_object</span><span class="o">.</span><span class="n">Z</span><span class="p">)[</span><span class="n">fselect</span><span class="p">]</span>
    <span class="c1"># put both strikes in the same quadrant for averaging</span>
    <span class="n">zstrike</span> <span class="o">=</span> <span class="n">zstrike</span> <span class="o">%</span> <span class="mi">90</span>
    <span class="n">zstrike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">zstrike</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">zstrike</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># add 90 to put one back in the other quadrant</span>
    <span class="n">zstrike</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">90</span>
    <span class="c1"># choose closest value to approx_strike</span>
    <span class="n">zstrike</span> <span class="o">=</span> <span class="n">zstrike</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zstrike</span> <span class="o">-</span> <span class="n">strike_approx</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zstrike</span> <span class="o">-</span> <span class="n">strike_approx</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zstrike</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">strike</span> <span class="o">=</span> <span class="n">zstrike</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># if the data are 1d set strike to 90 degrees (i.e. no rotation)</span>
        <span class="n">strike</span> <span class="o">=</span> <span class="mf">90.</span>

    <span class="k">return</span> <span class="n">strike</span></div>


<div class="viewcode-block" id="generate_inputfiles"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.generate_inputfiles">[docs]</a><span class="k">def</span> <span class="nf">generate_inputfiles</span><span class="p">(</span><span class="o">**</span><span class="n">input_parameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    generate all the input files to run occam1d, return the path and the</span>
<span class="sd">    startup files to run.</span>

<span class="sd">    author: Alison Kirkby (2016)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edipath</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;working_directory&#39;</span><span class="p">],</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;edipath&#39;</span><span class="p">])</span>
    <span class="n">edilist</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span> <span class="k">if</span> <span class="n">ff</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.edi&#39;</span><span class="p">)]</span>

    <span class="n">wkdir_master</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;working_directory&#39;</span><span class="p">],</span>
                           <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;master_savepath&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wkdir_master</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">wkdir_master</span><span class="p">)</span>

    <span class="n">rundirs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">edifile</span> <span class="ow">in</span> <span class="n">edilist</span><span class="p">:</span>
        <span class="c1"># read the edi file to get the station name</span>
        <span class="n">eo</span> <span class="o">=</span> <span class="n">mt</span><span class="o">.</span><span class="n">MT</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span> <span class="n">edifile</span><span class="p">))</span>
        <span class="nb">print</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;rotation_angle&#39;</span><span class="p">],</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;working_directory&#39;</span><span class="p">],</span> <span class="n">input_parameters</span><span class="p">[</span>
            <span class="s1">&#39;rotation_angle_file&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;rotation_angle&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;strike&#39;</span><span class="p">:</span>
            <span class="n">spr</span> <span class="o">=</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;strike_period_range&#39;</span><span class="p">]</span>
            <span class="n">fmax</span><span class="p">,</span> <span class="n">fmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">spr</span><span class="p">),</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">spr</span><span class="p">)]</span>
            <span class="n">rotangle</span> <span class="o">=</span> <span class="p">(</span><span class="n">get_strike</span><span class="p">(</span><span class="n">eo</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span>
                                   <span class="n">strike_approx</span><span class="o">=</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;strike_approx&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">90.</span><span class="p">)</span> <span class="o">%</span> <span class="mi">180</span>
        <span class="k">elif</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;rotation_angle&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;working_directory&#39;</span><span class="p">],</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;rotation_angle_file&#39;</span><span class="p">]))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="nb">print</span> <span class="n">line</span><span class="p">,</span> <span class="n">eo</span><span class="o">.</span><span class="n">station</span>
                <span class="k">while</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">eo</span><span class="o">.</span><span class="n">station</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0&#39;</span><span class="p">]</span>
                        <span class="k">break</span>
            <span class="n">rotangle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rotangle</span> <span class="o">=</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;rotation_angle&#39;</span><span class="p">]</span>
        <span class="nb">print</span> <span class="s2">&quot;rotation angle&quot;</span><span class="p">,</span> <span class="n">rotangle</span>
        <span class="c1"># create a working directory to store the inversion files in</span>
        <span class="n">svpath</span> <span class="o">=</span> <span class="s1">&#39;station&#39;</span> <span class="o">+</span> <span class="n">eo</span><span class="o">.</span><span class="n">station</span>
        <span class="n">wd</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wkdir_master</span><span class="p">,</span> <span class="n">svpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wd</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span>
        <span class="n">rundirs</span><span class="p">[</span><span class="n">svpath</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># create the model file</span>
        <span class="n">ocm</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">n_layers</span><span class="o">=</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;n_layers&#39;</span><span class="p">],</span> <span class="n">save_path</span><span class="o">=</span><span class="n">wd</span><span class="p">)</span>
        <span class="n">ocm</span><span class="o">.</span><span class="n">write_model_file</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;modes&#39;</span><span class="p">]:</span>
            <span class="c1"># create a data file for each mode</span>
            <span class="n">ocd</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
            <span class="n">ocd</span><span class="o">.</span><span class="n">_data_fn</span> <span class="o">=</span> <span class="s1">&#39;Occam1d_DataFile_rot</span><span class="si">%03i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rotangle</span>
            <span class="n">ocd</span><span class="o">.</span><span class="n">write_data_file</span><span class="p">(</span>
                <span class="n">res_errorfloor</span><span class="o">=</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;resistivity_errorfloor&#39;</span><span class="p">],</span>
                <span class="n">phase_errorfloor</span><span class="o">=</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;phase_errorfloor&#39;</span><span class="p">],</span>
                <span class="n">z_errorfloor</span><span class="o">=</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;z_errorfloor&#39;</span><span class="p">],</span>
                <span class="n">remove_outofquadrant</span><span class="o">=</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;remove_outofquadrant&#39;</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                <span class="n">edi_file</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span> <span class="n">edifile</span><span class="p">),</span>
                <span class="n">thetar</span><span class="o">=</span><span class="n">rotangle</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">wd</span><span class="p">)</span>

            <span class="n">ocs</span> <span class="o">=</span> <span class="n">Startup</span><span class="p">(</span><span class="n">data_fn</span><span class="o">=</span><span class="n">ocd</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span>
                          <span class="n">model_fn</span><span class="o">=</span><span class="n">ocm</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
            <span class="n">startup_fn</span> <span class="o">=</span> <span class="s1">&#39;OccamStartup1D&#39;</span> <span class="o">+</span> <span class="n">mode</span>
            <span class="n">ocs</span><span class="o">.</span><span class="n">write_startup_file</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="n">wd</span><span class="p">,</span>
                                   <span class="n">startup_fn</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">startup_fn</span><span class="p">),</span>
                                   <span class="n">max_iter</span><span class="o">=</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;iteration_max&#39;</span><span class="p">],</span>
                                   <span class="n">target_rms</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
            <span class="n">rundirs</span><span class="p">[</span><span class="n">svpath</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">startup_fn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wkdir_master</span><span class="p">,</span> <span class="n">rundirs</span></div>


<div class="viewcode-block" id="divide_inputs"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.divide_inputs">[docs]</a><span class="k">def</span> <span class="nf">divide_inputs</span><span class="p">(</span><span class="n">work_to_do</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    divide list of inputs into chunks to send to each processor</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">work_to_do</span><span class="p">):</span>
        <span class="n">chunks</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">chunks</span></div>


<div class="viewcode-block" id="build_run"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam1d.build_run">[docs]</a><span class="k">def</span> <span class="nf">build_run</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    build input files and run a suite of models in series (pretty quick so won&#39;t bother parallelise)</span>

<span class="sd">    run Occam1d on each set of inputs.</span>
<span class="sd">    Occam is run twice. First to get the lowest possible misfit.</span>
<span class="sd">    we then set the target rms to a factor (default 1.05) times the minimum rms achieved</span>
<span class="sd">    and run to get the smoothest model.</span>

<span class="sd">    author: Alison Kirkby (2016)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># from mpi4py import MPI</span>

    <span class="c1"># get command line arguments as a dictionary</span>
    <span class="n">input_parameters</span> <span class="o">=</span> <span class="n">update_inputs</span><span class="p">()</span>

    <span class="c1"># create the inputs and get the run directories</span>
    <span class="n">master_wkdir</span><span class="p">,</span> <span class="n">run_directories</span> <span class="o">=</span> <span class="n">generate_inputfiles</span><span class="p">(</span><span class="o">**</span><span class="n">input_parameters</span><span class="p">)</span>

    <span class="c1"># run Occam1d on each set of inputs.</span>
    <span class="c1"># Occam is run twice. First to get the lowest possible misfit.</span>
    <span class="c1"># we then set the target rms to a factor (default 1.05) times the minimum rms achieved</span>
    <span class="c1"># and run to get the smoothest model.</span>
    <span class="k">for</span> <span class="n">rundir</span> <span class="ow">in</span> <span class="n">run_directories</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">wd</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">master_wkdir</span><span class="p">,</span> <span class="n">rundir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">startupfile</span> <span class="ow">in</span> <span class="n">run_directories</span><span class="p">[</span><span class="n">rundir</span><span class="p">]:</span>
            <span class="c1"># define some parameters</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">startupfile</span><span class="p">[</span><span class="mi">14</span><span class="p">:]</span>
            <span class="n">iterstring</span> <span class="o">=</span> <span class="s1">&#39;RMSmin&#39;</span> <span class="o">+</span> <span class="n">mode</span>
            <span class="c1"># run for minimum rms</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;program_location&#39;</span><span class="p">],</span>
                             <span class="n">startupfile</span><span class="p">,</span>
                             <span class="n">iterstring</span><span class="p">])</span>
            <span class="c1"># read the iter file to get minimum rms</span>
            <span class="n">iterfile</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">ff</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">iterstring</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ff</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.iter&#39;</span><span class="p">))])</span>
            <span class="n">startup</span> <span class="o">=</span> <span class="n">Startup</span><span class="p">()</span>
            <span class="n">startup</span><span class="o">.</span><span class="n">read_startup_file</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">iterfile</span><span class="p">))</span>
            <span class="c1"># create a new startup file the same as the previous one but target rms is factor*minimum_rms</span>
            <span class="n">startupnew</span> <span class="o">=</span> <span class="n">Startup</span><span class="p">(</span><span class="n">data_fn</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">startup</span><span class="o">.</span><span class="n">data_file</span><span class="p">),</span>
                                 <span class="n">model_fn</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">startup</span><span class="o">.</span><span class="n">model_file</span><span class="p">),</span>
                                 <span class="n">max_iter</span><span class="o">=</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;iteration_max&#39;</span><span class="p">],</span>
                                 <span class="n">target_rms</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">startup</span><span class="o">.</span><span class="n">misfit_value</span><span class="p">)</span> <span class="o">*</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;rms_factor&#39;</span><span class="p">])</span>
            <span class="n">startupnew</span><span class="o">.</span><span class="n">write_startup_file</span><span class="p">(</span><span class="n">startup_fn</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">startupfile</span><span class="p">),</span> <span class="n">save_path</span><span class="o">=</span><span class="n">wd</span><span class="p">)</span>
            <span class="c1"># run occam again</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">input_parameters</span><span class="p">[</span><span class="s1">&#39;program_location&#39;</span><span class="p">],</span>
                             <span class="n">startupfile</span><span class="p">,</span>
                             <span class="s1">&#39;Smooth&#39;</span> <span class="o">+</span> <span class="n">mode</span><span class="p">])</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">build_run</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_doc.html">mtpy 1.01.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Geoscience Australia.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.2.
    </div>
  </body>
</html>